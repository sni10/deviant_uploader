–ê–Ω–∞–ª–∏–∑ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö –Ω–∞—Ä—É—à–µ–Ω–∏–π (DeviantArt uploader)

–ü—Ä–æ–≤–µ–ª —Ä–µ–≤—å—é —Ç–µ–∫—É—â–µ–π –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã. –ù–∏–∂–µ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω—ã –∫–ª—é—á–µ–≤—ã–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–∏—Å–∫–∏, –Ω–∞—Ä—É—à–∞—é—â–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã SRP/DDD/—Ç–µ—Å—Ç–æ–ø—Ä–∏–≥–æ–¥–Ω–æ—Å—Ç—å, –∏ –ø–ª–∞–Ω –∏—Ö —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è.

üö® –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è

1. "God object" UploaderService (‚âà520 —Å—Ç—Ä–æ–∫)
   –§–∞–π–ª: src/service/uploader.py
   –°–º–µ—à–∞–Ω—ã –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏: —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –§–°, –∑–∞–≥—Ä—É–∑–∫–∞ —à–∞–±–ª–æ–Ω–æ–≤/–º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö, —Å–æ–∑–¥–∞–Ω–∏–µ –¥–æ–º–µ–Ω–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π, HTTP-–≤—ã–∑–æ–≤—ã Stash/Publish, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞–º–∏/–ë–î, –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤. –û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä —Å–ª–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–∞—Ç—å.
   –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –†–∞–∑–±–∏—Ç—å –Ω–∞ –º–æ–¥—É–ª–∏: template_loader.py, upload_scanner.py, metadata_loader.py, stash_client.py (HTTP), publish_client.py (HTTP), upload_orchestrator.py (—Ç–æ–ª—å–∫–æ –ø–æ—Ç–æ–∫ —Å–æ—Å—Ç–æ—è–Ω–∏–π), file_mover.py. –ò–Ω—ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (HTTP-–∫–ª–∏–µ–Ω—Ç, —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏, –∫–æ–Ω—Ñ–∏–≥, –ª–æ–≥–≥–µ—Ä) —è–≤–Ω–æ.

2. Config singleton —Å–æ side-effect'–∞–º–∏ –∏ —Å–∫—Ä—ã—Ç—ã–º–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
   –§–∞–π–ª: src/config/settings.py
   –°–º–µ—à–∞–Ω—ã: —á—Ç–µ–Ω–∏–µ env, –≤–∞–ª–∏–¥–∞—Ü–∏—è, —Å–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π/–ë–î, –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã API, singleton-–¥–æ—Å—Ç—É–ø. –°–æ–∑–¥–∞–µ—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –Ω–∞ –∏–º–ø–æ—Ä—Ç, —É—Å–ª–æ–∂–Ω—è–µ—Ç —é–Ω–∏—Ç-—Ç–µ—Å—Ç—ã –∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ. –°–µ—Ä–≤–∏—Å—ã –±–µ—Ä—É—Ç –≥–ª–æ–±–∞–ª—å–Ω—ã–π Config —á–µ—Ä–µ–∑ get_config(), —á—Ç–æ –º–µ—à–∞–µ—Ç –ø–æ–¥–º–µ–Ω–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤ —Ç–µ—Å—Ç–∞—Ö.
   –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –†–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ config_schema.py (dataclass –Ω–∞—Å—Ç—Ä–æ–µ–∫), config_loader.py (—á—Ç–µ–Ω–∏–µ .env/–≤–∞–ª–∏–¥–∞—Ü–∏—è –±–µ–∑ I/O), paths_initializer.py (—Å–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ç–∞–ª–æ–≥–æ–≤, –º–∏–≥—Ä–∞—Ü–∏–∏), settings_provider.py (DI-friendly —Ñ–∞–±—Ä–∏–∫–∞). –ü–µ—Ä–µ–¥–∞–≤–∞—Ç—å config –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã —Å–µ—Ä–≤–∏—Å–æ–≤, —É–±—Ä–∞—Ç—å –ø–æ–±–æ—á–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –∏–∑ __init__.

3. AuthService: —Å–º–µ—à–∞–Ω–Ω—ã–π UI/HTTP/—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –±–µ–∑ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–π
   –§–∞–π–ª: src/service/auth_service.py
   –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏: –æ—Ç–∫—Ä—ã—Ç–∏–µ –±—Ä–∞—É–∑–µ—Ä–∞, –ª–æ–∫–∞–ª—å–Ω—ã–π HTTP-—Å–µ—Ä–≤–µ—Ä, –æ–±–º–µ–Ω/refresh —Ç–æ–∫–µ–Ω–æ–≤, –≤–∞–ª–∏–¥–∞—Ü–∏—è, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ —á–µ—Ä–µ–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π ‚Äî –≤—Å–µ –≤ –æ–¥–Ω–æ–º –∫–ª–∞—Å—Å–µ, –ø–ª—é—Å –ø—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã requests –∏ –≥–ª–æ–±–∞–ª—å–Ω—ã–π Config. –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ unit-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –±–µ–∑ —Å–µ—Ç–∏/–±—Ä–∞—É–∑–µ—Ä–∞.
   –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –í–≤–µ—Å—Ç–∏ callback_server.py (HTTPServer + handler), oauth_client.py (requests-–æ–±–µ—Ä—Ç–∫–∞ –¥–ª—è DeviantArt endpoints), token_service.py (—Ä–∞–±–æ—Ç–∞ —Å repo –∏ –¥–∞—Ç–∞–º–∏), auth_flow.py (–æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è). –í—Å–µ HTTP-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ ‚Äî —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ—Ç—å headless/dry-run –¥–ª—è —Ç–µ—Å—Ç–æ–≤.

4. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ç–µ—Å—Ç–æ–≤ –¥–ª—è —Å–µ—Ä–≤–∏—Å–æ–≤/—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ –∏ HTTP-–∞–±—Å—Ç—Ä–∞–∫—Ü–∏–π
   –¢–µ–∫—É—â–∏–µ —Ç–µ—Å—Ç—ã –ø–æ–∫—Ä—ã–≤–∞—é—Ç —Ç–æ–ª—å–∫–æ domain –º–æ–¥–µ–ª–∏. –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫ –º–∏–≥—Ä–∞—Ü–∏–π, —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤, OAuth/–∑–∞–≥—Ä—É–∑–∫–∏ (–º–æ–∫), CLI —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤. –ü—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã requests –±–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –Ω–µ –ø–æ–∑–≤–æ–ª—è—é—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ –º–æ–∫–∞—Ç—å.
   –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å HttpClient (–∏–ª–∏ –ø—Ä–æ—Ç–æ–∫–æ–ª) –∏ –≤–Ω–µ–¥—Ä—è—Ç—å –≤ Auth/Gallery/User/Uploader HTTP-–∫–ª–∏–µ–Ω—Ç—ã. –ù–∞–ø–∏—Å–∞—Ç—å pytest-–Ω–∞–±–æ—Ä—ã: —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ —Å –≤—Ä–µ–º–µ–Ω–Ω–æ–π SQLite, —Å–µ—Ä–≤–∏—Å—ã —Å –º–æ–∫–∞–º–∏ HTTP, smoke –¥–ª—è main.py/fetch_*.py —Å —Ñ–∏–∫—Ç–∏–≤–Ω—ã–º–∏ —Ç–æ–∫–µ–Ω–∞–º–∏. –¶–µ–ª—å ‚Äî –ø–æ–∫—Ä—ã—Ç–∏–µ ‚â•85% + —Ä–µ–≥—Ä–µ—Å—Å–∏–∏ –Ω–∞ —Å—Ç–∞—Ç—É—Å–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã.

‚ö†Ô∏è –°—Ä–µ–¥–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

- database.init_database –ø–µ—á–∞—Ç–∞–µ—Ç –≤ stdout –≤–æ –≤—Ä–µ–º—è –º–∏–≥—Ä–∞—Ü–∏–π ‚Äî —à—É–º–∏—Ç –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏/—Ç–µ—Å—Ç–∞—Ö; –∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ –Ω–∞ –ª–æ–≥–≥–µ—Ä –∏ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –≤ –≤—ã–∑—ã–≤–∞—é—â–µ–º –∫–æ–¥–µ.
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ–º –ë–î —Å–∫—Ä—ã—Ç–æ: create_repositories –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—â–∏–π Connection, –∞ close –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –æ–¥–∏–Ω —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π. –Ø–≤–Ω—ã–π Unit of Work –∏–ª–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä —É–ø—Ä–æ—Å—Ç–∏—Ç –∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª.

‚úÖ –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã

- –ß–∏—Å—Ç—ã–µ domain –º–æ–¥–µ–ª–∏ –±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, –Ω–µ–±–æ–ª—å—à–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏, –æ—Ç–¥–µ–ª–µ–Ω–Ω–∞—è –ª–æ–≥–≥–µ—Ä-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è.

üìã –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –î–µ–∫–æ–º–ø–æ–∑–∏—Ä–æ–≤–∞—Ç—å UploaderService –Ω–∞ –≤—ã–¥–µ–ª–µ–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—ã/—É—Ç–∏–ª–∏—Ç—ã –∏ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä.
–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –†–∞—Å—â–µ–ø–∏—Ç—å Config –Ω–∞ —Å—Ö–µ–º—É/–∑–∞–≥—Ä—É–∑—á–∏–∫/–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ç–æ—Ä –ø—É—Ç–µ–π; —É–±—Ä–∞—Ç—å side-effect'—ã –Ω–∞ –∏–º–ø–æ—Ä—Ç, –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å config —á–µ—Ä–µ–∑ DI.
–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: –†–∞—Å—Å–ª–æ–∏—Ç—å AuthService (callback server, OAuth client, token service) –∏ –≤–≤–µ—Å—Ç–∏ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—é HttpClient –¥–ª—è –≤—Å–µ—Ö API-—Å–µ—Ä–≤–∏—Å–æ–≤.
–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 4: –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –ø–∞–∫–µ—Ç—ã –¥–ª—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤/—Å–µ—Ä–≤–∏—Å–æ–≤/CLI —Å –º–æ–∫–∞–º–∏ HTTP –∏ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –ë–î; —Ü–µ–ª—å –ø–æ–∫—Ä—ã—Ç–∏—è ‚â•85%.
–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 5: –û—á–∏—Å—Ç–∏—Ç—å –ø–æ–±–æ—á–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –º–∏–≥—Ä–∞—Ü–∏–π (stdout) –∏ –≤–≤–µ—Å—Ç–∏ —É–ø—Ä–∞–≤–ª—è–µ–º—ã–π –∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π (–∫–æ–Ω—Ç–µ–∫—Å—Ç/Unit of Work).
